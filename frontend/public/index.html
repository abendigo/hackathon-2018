<!-- <script type='text/javascript' src='midi.js'></script> -->
<!-- <script type='text/javascript' src='//www.midijs.net/lib/midi.js'></script> -->

<canvas id=canvas width=900 height=600></canvas>

<br />
<button id='clear'>Clear</button>
<button id='submit'>Submit</button>


<audio controls>
  <source src="audio/stereo.flac" />
</audio>

<!-- <img src="images/music.jpg" /> -->

<script>
  const canvas = document.getElementById("canvas");
  const context = canvas.getContext("2d");

  const imageObj = new Image();

  imageObj.onload = function() {
    context.drawImage(imageObj, 0, 0, 900, 600, 0, 0, 900, 600);
  };
  imageObj.src = 'images/background.jpg';

  canvas.width = 900; //parseInt(paint_style.getPropertyValue('width'));
  canvas.height = 600; //parseInt(paint_style.getPropertyValue('height'));

  let mouse = {x: 0, y: 0};
 
  canvas.addEventListener('mousemove', function(e) {
    mouse.x = e.pageX - this.offsetLeft;
    mouse.y = e.pageY - this.offsetTop;
  }, false);

  context.lineWidth = 3;
  context.lineJoin = 'round';
  context.lineCap = 'round';
  context.strokeStyle = '#000000';
 
  canvas.addEventListener('mousedown', function(e) {
    context.beginPath();
    context.moveTo(mouse.x, mouse.y);
  
      canvas.addEventListener('mousemove', onPaint, false);
  }, false);
 
  canvas.addEventListener('mouseup', function() {
      canvas.removeEventListener('mousemove', onPaint, false);
  }, false);
  
  var onPaint = function() {
    context.lineTo(mouse.x, mouse.y);
    context.stroke();
  };





  document.getElementById('clear').addEventListener('click', () => {
    console.log('clear')
    context.drawImage(imageObj, 0, 0, 1200, 700, 0, 0, 600, 350);

    // MIDIjs.play('./MIDI_sample.midi');
  });

  document.getElementById('submit').addEventListener('click', () => {
    console.log('submit')
    const img    = canvas.toDataURL("image/png");
    document.write('<img src="'+img+'"/>');

    const url = 'http://localhost:3000/img2mus';
    fetch(url, {
      method: 'POST',
      body: img
    }).then(response => {
      console.log('response', response)
    }, error => {
      console.log('error', error)
    })
  });
</script>
